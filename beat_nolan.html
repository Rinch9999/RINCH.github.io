<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æš´æ‰“ä¹”çº³æ£®Â·è¯ºå…°</title>
    <style>
        :root {
            --primary: #333333;
            --secondary: #666666;
            --dark: #000000;
            --light: #ffffff;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #000000, #333333, #666666);
            color: var(--light);
            text-align: center;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            width: 90%;
        }

        header {
            margin: 20px 0;
            animation: fadeIn 1s ease;
        }

        h1 {
            font-size: 2.8rem;
            margin: 0;
            text-shadow: 0 3px 10px rgba(0, 0, 0, 0.5);
            background: linear-gradient(90deg, #ffffff, #cccccc);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .game-description {
            font-size: 1.2rem;
            margin: 15px 0 30px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.5;
        }

        #gameContainer {
            position: relative;
            width: 100%;
            height: 500px;
            margin: 20px auto;
            border: 3px solid rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            background-color: rgba(0, 0, 0, 0.4);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: var(--transition);
        }

        #gameContainer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.1), transparent 70%);
            pointer-events: none;
        }

        #target {
            position: absolute;
            width: 100px;
            height: 100px;
            cursor: pointer;
            transition: transform 0.15s cubic-bezier(0.34, 1.56, 0.64, 1);
            background-size: cover;
            background-position: center;
            border-radius: 50%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            z-index: 2;
            transform-origin: center;
            will-change: transform, left, top; /* ä¼˜åŒ–åŠ¨ç”»æ€§èƒ½ */
        }

        #target:hover {
            transform: scale(1.1) rotate(5deg);
        }

        #target.hit {
            animation: hitEffect 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes hitEffect {
            0% { transform: scale(1); }
            50% { transform: scale(0.8) rotate(-10deg); opacity: 0.7; }
            100% { transform: scale(1) rotate(0); }
        }

        @keyframes rippleEffect {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }

        #ui {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 30px auto;
            padding: 15px 20px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            width: 80%;
            max-width: 700px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(5px);
        }

        .ui-item {
            font-size: 1.4rem;
            padding: 8px 15px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            min-width: 120px;
        }

        .ui-item span {
            font-weight: bold;
            color: #cccccc;
        }

        #startButton, #restartButton {
            padding: 15px 35px;
            font-size: 1.3rem;
            background-color: var(--primary);
            color: var(--light);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin: 15px;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(51, 51, 51, 0.6);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        #startButton:hover, #restartButton:hover {
            background-color: #666666;
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(51, 51, 51, 0.8);
        }

        #startButton:active, #restartButton:active {
            transform: translateY(1px);
        }

        #message {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 25px auto;
            min-height: 60px;
            color: #cccccc;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
            max-width: 800px;
            padding: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        #restartButton {
            display: none;
        }

        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .game-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .difficulty-selection {
            background-color: rgba(26, 42, 108, 0.9);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: var(--shadow);
            max-width: 500px;
            width: 90%;
        }

        .difficulty-selection h2 {
            margin-top: 0;
            color: var(--secondary);
        }

        .difficulty-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .difficulty-btn {
            padding: 12px 25px;
            font-size: 1.1rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            min-width: 120px;
            font-weight: 600;
        }

        .difficulty-btn.easy {
            background-color: #999999;
            color: white;
        }

        .difficulty-btn.medium {
            background-color: #666666;
            color: white;
        }

        .difficulty-btn.hard {
            background-color: #333333;
            color: white;
        }

        .difficulty-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        footer {
            margin: 20px 0;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            #gameContainer {
                height: 400px;
            }

            #ui {
                flex-direction: column;
                gap: 10px;
                width: 90%;
            }

            .ui-item {
                width: 80%;
                font-size: 1.2rem;
            }

            #message {
                font-size: 1.4rem;
            }

            #startButton, #restartButton {
                padding: 12px 25px;
                font-size: 1.1rem;
            }

            .difficulty-buttons {
                flex-direction: column;
                align-items: center;
            }

            .difficulty-btn {
                width: 200px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }

            #gameContainer {
                height: 350px;
            }

            #target {
                width: 80px;
                height: 80px;
            }

            .game-description {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æš´æ‰“ä¹”çº³æ£®Â·è¯ºå…°</h1>
            <p class="game-description">åœ¨é™å®šæ—¶é—´å†…ï¼Œå°½æƒ…ç‚¹å‡»é‚£ä¸ªè®©ä½ çƒ§è„‘çš„"ç½ªé­ç¥¸é¦–"ï¼éšç€å…³å¡æå‡ï¼Œç›®æ ‡ä¼šå˜å¾—æ›´å¿«æ›´éš¾å‡»ä¸­ï¼</p>
        </header>

        <div id="ui">
            <div class="ui-item">æ—¶é—´: <span id="timer" aria-live="polite">60</span>ç§’</div>
            <div class="ui-item">åˆ†æ•°: <span id="score" aria-live="polite">0</span></div>
            <div class="ui-item">å…³å¡: <span id="levelDisplay" aria-live="polite">1</span></div>
        </div>

        <div id="buttonContainer">
            <button id="startButton" aria-label="å¼€å§‹æ¸¸æˆ">å¼€å§‹æ¸¸æˆï¼</button>
            <button id="restartButton" aria-label="å†ç©ä¸€æ¬¡">å†ç©ä¸€æ¬¡ï¼Ÿ</button>
        </div>

        <div id="gameContainer" aria-label="æ¸¸æˆåŒºåŸŸ">
            <div id="target" role="button" tabindex="0" aria-label="ç‚¹å‡»ç›®æ ‡"></div>
            <div class="game-overlay" id="difficultyOverlay" aria-modal="true" role="dialog" aria-labelledby="difficultyTitle">
                <div class="difficulty-selection">
                    <h2 id="difficultyTitle">é€‰æ‹©éš¾åº¦</h2>
                    <div class="difficulty-buttons">
                        <button class="difficulty-btn easy" data-speed="1000" data-time="60" data-level-up="10" aria-label="ç®€å•éš¾åº¦">ç®€å•</button>
                        <button class="difficulty-btn medium" data-speed="800" data-time="50" data-level-up="15" aria-label="ä¸­ç­‰éš¾åº¦">ä¸­ç­‰</button>
                        <button class="difficulty-btn hard" data-speed="600" data-time="40" data-level-up="20" aria-label="å›°éš¾éš¾åº¦">å›°éš¾</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="message" aria-live="assertive"></div>
    </div>

    <footer>
        <p>æ¸¸æˆä»…ä¸ºå¨±ä¹ç›®çš„ï¼Œæ— çœŸå®äººç‰©æ”»å‡»æ„å›¾</p>
    </footer>

    <script>
        // è·å–DOMå…ƒç´ 
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score');
        const target = document.getElementById('target');
        const messageDisplay = document.getElementById('message');
        const gameContainer = document.getElementById('gameContainer');
        const levelDisplay = document.getElementById('levelDisplay');
        const difficultyOverlay = document.getElementById('difficultyOverlay');
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');

        // æ¸¸æˆå˜é‡åˆå§‹åŒ–
        let score = 0; // å½“å‰åˆ†æ•°
        let timeLeft = 60; // å‰©ä½™æ—¶é—´ï¼ˆç§’ï¼‰
        let gameActive = false; // æ¸¸æˆæ˜¯å¦æ¿€æ´»
        let timerId = null; // è®¡æ—¶å™¨ID
        let moveTimerId = null; // ç§»åŠ¨è®¡æ—¶å™¨ID
        let currentSpeed = 1000; // é»˜è®¤ç§»åŠ¨é€Ÿåº¦ï¼ˆæ¯«ç§’ï¼‰
        let levelUpScore = 10; // é»˜è®¤å‡çº§æ‰€éœ€åˆ†æ•°
        let currentLevel = 1; // å½“å‰å…³å¡
        let hitCount = 0; // å‡»ä¸­æ¬¡æ•°
        let missCount = 0; // æœªå‡»ä¸­æ¬¡æ•°
        let bestScore = localStorage.getItem('bestScore') || 0; // æœ€ä½³æˆç»©
        let comboCount = 0; // è¿å‡»æ¬¡æ•°
        let comboTimer = null; // è¿å‡»è®¡æ—¶å™¨
        const COMBO_TIMEOUT = 1000; // è¿å‡»è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰

        // ä¹”çº³æ£®Â·è¯ºå…°çš„å›¾ç‰‡URL
        const nolanImageUrl = './images/nolan.jpg';

        // æ£€æŸ¥å›¾åƒæ˜¯å¦åŠ è½½æˆåŠŸ
        const nolanImage = new Image();
        nolanImage.onload = function() {
            console.log('å›¾åƒåŠ è½½æˆåŠŸ');
        };
        nolanImage.onerror = function() {
            console.error('å›¾åƒåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ ·å¼');
            // æ·»åŠ å¤‡ç”¨æ ·å¼
            target.style.backgroundColor = '#e74c3c';
            target.style.display = 'flex';
            target.style.justifyContent = 'center';
            target.style.alignItems = 'center';
            target.textContent = 'ğŸ‘Š';
        };
        nolanImage.src = nolanImageUrl;

        // è®¾ç½®ç›®æ ‡çš„å›¾ç‰‡
        target.style.backgroundImage = `url('${nolanImageUrl}')`;

        // ç§»åŠ¨ç›®æ ‡çš„å‡½æ•°
        function moveTarget() {
            if (!gameActive) return;

            try {
                const containerRect = gameContainer.getBoundingClientRect();
                const targetRect = target.getBoundingClientRect();

                // è®¡ç®—æœ€å¤§ç§»åŠ¨èŒƒå›´
                const maxX = containerRect.width - targetRect.width;
                const maxY = containerRect.height - targetRect.height;

                // ç”Ÿæˆéšæœºä½ç½®
                const randomX = Math.floor(Math.random() * maxX);
                const randomY = Math.floor(Math.random() * maxY);

                // æ›´æ–°ç›®æ ‡ä½ç½®
                target.style.left = `${randomX}px`;
                target.style.top = `${randomY}px`;
            } catch (error) {
                console.error('ç§»åŠ¨ç›®æ ‡æ—¶å‡ºé”™:', error);
            }
        }

        // åˆ›å»ºç‚¹å‡»éŸ³æ•ˆ
        function createClickSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (error) {
                console.error('åˆ›å»ºéŸ³æ•ˆæ—¶å‡ºé”™:', error);
                // å¿½ç•¥éŸ³æ•ˆé”™è¯¯ï¼Œä¸å½±å“æ¸¸æˆè¿è¡Œ
            }
        }

        // ç›®æ ‡è¢«ç‚¹å‡»æ—¶çš„å‡½æ•°
        function hitTarget() {
            if (!gameActive) return;

            try {
                // å¢åŠ è¿å‡»è®¡æ•°
                comboCount++;
                
                // æ¸…é™¤æ—§çš„è¿å‡»è®¡æ—¶å™¨
                if (comboTimer) {
                    clearTimeout(comboTimer);
                }
                
                // è®¾ç½®æ–°çš„è¿å‡»è®¡æ—¶å™¨
                comboTimer = setTimeout(() => {
                    comboCount = 0;
                }, COMBO_TIMEOUT);
                
                // è®¡ç®—åŸºç¡€åˆ†æ•°å’Œè¿å‡»å¥–åŠ±
                const baseScore = 1;
                const comboBonus = Math.floor(comboCount / 5); // æ¯5è¿å‡»è·å¾—1ç‚¹é¢å¤–å¥–åŠ±
                const totalPoints = baseScore + comboBonus;
                
                score += totalPoints;
                hitCount++;
                scoreDisplay.textContent = score;

                // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
                createClickSound();

                // æ·»åŠ è¢«å‡»ä¸­çš„åŠ¨ç”»æ•ˆæœ
                target.classList.add('hit');
                setTimeout(() => {
                    target.classList.remove('hit');
                }, 300);

                // åˆ›å»ºç‚¹å‡»æ³¢çº¹æ•ˆæœ
                const ripple = document.createElement('div');
                ripple.style.position = 'absolute';
                ripple.style.width = '100px';
                ripple.style.height = '100px';
                ripple.style.borderRadius = '50%';
                ripple.style.border = '3px solid rgba(255, 255, 255, 0.8)';
                ripple.style.pointerEvents = 'none';
                ripple.style.animation = 'rippleEffect 0.5s ease-out forwards';
                ripple.style.left = target.style.left;
                ripple.style.top = target.style.top;
                gameContainer.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 500);
                
                // æ˜¾ç¤ºè¿å‡»æ¶ˆæ¯
                if (comboCount > 1) {
                    showTemporaryMessage(`è¿å‡»ï¼x${comboCount} (+${comboBonus})`, 500);
                }

                // æ£€æŸ¥æ˜¯å¦å‡çº§
                checkLevelUp();

                // å‡»ä¸­åç«‹å³ç§»åŠ¨
                moveTarget();
            } catch (error) {
                console.error('å¤„ç†å‡»ä¸­äº‹ä»¶æ—¶å‡ºé”™:', error);
            }
        }

        // æ£€æŸ¥æ˜¯å¦å‡çº§
        function checkLevelUp() {
            try {
                const requiredScore = currentLevel * levelUpScore;
                
                if (score >= requiredScore) {
                    levelUp();
                }
            } catch (error) {
                console.error('æ£€æŸ¥å‡çº§æ—¶å‡ºé”™:', error);
            }
        }

        // å‡çº§å¤„ç†
        function levelUp() {
            try {
                currentLevel++;
                levelDisplay.textContent = currentLevel;
                
                // éšç€å…³å¡æå‡ï¼Œç§»åŠ¨é€Ÿåº¦åŠ å¿«ï¼ˆæœ€ä½200msï¼‰
                const newSpeed = Math.max(200, currentSpeed - 50);
                
                // æ¸…é™¤æ—§çš„ç§»åŠ¨è®¡æ—¶å™¨ï¼Œè®¾ç½®æ–°çš„
                if (moveTimerId) {
                    clearInterval(moveTimerId);
                }
                currentSpeed = newSpeed;
                moveTimerId = setInterval(moveTarget, currentSpeed);
                
                // æ˜¾ç¤ºå‡çº§æ¶ˆæ¯
                showTemporaryMessage(`å‡çº§åˆ°å…³å¡ ${currentLevel}ï¼é€Ÿåº¦æ›´å¿«äº†ï¼`, 1500);
            } catch (error) {
                console.error('å‡çº§å¤„ç†æ—¶å‡ºé”™:', error);
            }
        }

        // æ˜¾ç¤ºä¸´æ—¶æ¶ˆæ¯
        function showTemporaryMessage(text, duration) {
            try {
                const originalMessage = messageDisplay.textContent;
                messageDisplay.textContent = text;
                
                setTimeout(() => {
                    if (gameActive) {
                        messageDisplay.textContent = originalMessage;
                    }
                }, duration);
            } catch (error) {
                console.error('æ˜¾ç¤ºä¸´æ—¶æ¶ˆæ¯æ—¶å‡ºé”™:', error);
            }
        }

        // æ›´æ–°è®¡æ—¶å™¨
        function updateTimer() {
            try {
                timeLeft--;
                timerDisplay.textContent = timeLeft;

                // æœ€å10ç§’æ·»åŠ è§†è§‰è­¦å‘Š
                if (timeLeft <= 10) {
                    timerDisplay.style.color = '#e74c3c';
                    timerDisplay.style.animation = 'pulse 1s infinite';
                } else {
                    timerDisplay.style.color = '';
                    timerDisplay.style.animation = '';
                }

                if (timeLeft <= 0) {
                    endGame();
                }
            } catch (error) {
                console.error('æ›´æ–°è®¡æ—¶å™¨æ—¶å‡ºé”™:', error);
                endGame(); // å‡ºé”™æ—¶ç»“æŸæ¸¸æˆ
            }
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            try {
                gameActive = true;
                score = 0;
                hitCount = 0;
                missCount = 0;
                comboCount = 0;
                currentLevel = 1;
                
                // æ¸…é™¤è¿å‡»è®¡æ—¶å™¨
                if (comboTimer) {
                    clearTimeout(comboTimer);
                    comboTimer = null;
                }
                
                scoreDisplay.textContent = score;
                levelDisplay.textContent = currentLevel;
                timerDisplay.textContent = timeLeft;
                messageDisplay.textContent = "";
                startButton.style.display = 'none';
                restartButton.style.display = 'none';
                difficultyOverlay.classList.remove('active');

                // é‡ç½®è®¡æ—¶å™¨æ ·å¼
                timerDisplay.style.color = '';
                timerDisplay.style.animation = '';

                // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„æ—§è®¡æ—¶å™¨
                if (timerId) {
                    clearInterval(timerId);
                }
                if (moveTimerId) {
                    clearInterval(moveTimerId);
                }

                // å¯åŠ¨è®¡æ—¶å™¨
                timerId = setInterval(updateTimer, 1000);
                // å¯åŠ¨ç§»åŠ¨
                moveTimerId = setInterval(moveTarget, currentSpeed);

                // åˆå§‹ç§»åŠ¨ä¸€æ¬¡
                moveTarget();
            } catch (error) {
                console.error('å¼€å§‹æ¸¸æˆæ—¶å‡ºé”™:', error);
                endGame(); // å‡ºé”™æ—¶ç»“æŸæ¸¸æˆ
            }
        }

        // ç»“æŸæ¸¸æˆ
        function endGame() {
            try {
                gameActive = false;
                
                // æ¸…é™¤æ‰€æœ‰è®¡æ—¶å™¨
                if (timerId) {
                    clearInterval(timerId);
                    timerId = null;
                }
                if (moveTimerId) {
                    clearInterval(moveTimerId);
                    moveTimerId = null;
                }
                if (comboTimer) {
                    clearTimeout(comboTimer);
                    comboTimer = null;
                }

                // æ›´æ–°æœ€ä½³æˆç»©
                if (score > bestScore) {
                    bestScore = score;
                    localStorage.setItem('bestScore', bestScore);
                    showTemporaryMessage('æ–°çºªå½•ï¼', 2000);
                }

                // è®¡ç®—å‘½ä¸­ç‡
                const totalAttempts = hitCount + missCount;
                const hitRate = totalAttempts > 0 ? Math.round((hitCount / totalAttempts) * 100) : 0;

                let message = "";
                if (score > currentLevel * levelUpScore * 2) {
                    message = "å¤ªå‰å®³äº†ï¼ä½ å·²ç»è¶…è¶Šäº†è¯ºå…°çš„æ‰€æœ‰å™äº‹è¯¡è®¡ï¼";
                } else if (score > currentLevel * levelUpScore) {
                    message = "å¾ˆæ£’ï¼è¯ºå…°å¯¹ä½ åˆ®ç›®ç›¸çœ‹äº†ï¼";
                } else if (score > currentLevel * levelUpScore / 2) {
                    message = "ä¸é”™ï¼ä½†è¿˜éœ€è¦å¤šç»ƒä¹ æ‰èƒ½å®Œå…¨ç ´è§£è¯ºå…°çš„è¿·å®«ï¼";
                } else {
                    message = "ç»§ç»­åŠªåŠ›ï¼è¯ºå…°è¿˜åœ¨ç­‰ç€ä½ æŒ‘æˆ˜å‘¢ï¼";
                }
                
                // æ˜¾ç¤ºæ¸¸æˆç»“æŸç»Ÿè®¡
                messageDisplay.innerHTML = `
                    <div style="margin-bottom: 15px;">æ¸¸æˆç»“æŸï¼</div>
                    <div style="margin-bottom: 10px;">ä½ çš„æœ€ç»ˆå¾—åˆ†æ˜¯ï¼š<strong>${score}</strong>ï¼Œè¾¾åˆ°äº†ç¬¬<strong>${currentLevel}</strong>å…³ã€‚</div>
                    <div style="margin-bottom: 10px;">${message}</div>
                    <div style="margin-bottom: 10px;">æœ€ä½³æˆç»©ï¼š<strong>${bestScore}</strong></div>
                    <div style="margin-bottom: 10px;">ç»Ÿè®¡ä¿¡æ¯ï¼š</div>
                    <div style="margin-bottom: 5px;">å‡»ä¸­æ¬¡æ•°ï¼š<strong>${hitCount}</strong></div>
                    <div style="margin-bottom: 5px;">æœªå‡»ä¸­æ¬¡æ•°ï¼š<strong>${missCount}</strong></div>
                    <div style="margin-bottom: 5px;">å‘½ä¸­ç‡ï¼š<strong>${hitRate}%</strong></div>
                `;

                restartButton.style.display = 'inline-block';
            } catch (error) {
                console.error('ç»“æŸæ¸¸æˆæ—¶å‡ºé”™:', error);
                messageDisplay.textContent = "æ¸¸æˆå‡ºç°é”™è¯¯ï¼Œè¯·é‡æ–°å¼€å§‹ï¼";
                restartButton.style.display = 'inline-block';
            }
        }

        // äº‹ä»¶ç›‘å¬ä¼˜åŒ–ï¼šä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†éš¾åº¦æŒ‰é’®ç‚¹å‡»
        document.querySelector('.difficulty-buttons').addEventListener('click', (e) => {
            if (e.target.classList.contains('difficulty-btn')) {
                try {
                    const button = e.target;
                    currentSpeed = parseInt(button.dataset.speed);
                    timeLeft = parseInt(button.dataset.time);
                    levelUpScore = parseInt(button.dataset.levelUp);
                    
                    // éªŒè¯éš¾åº¦å‚æ•°
                    if (isNaN(currentSpeed) || isNaN(timeLeft) || isNaN(levelUpScore)) {
                        throw new Error('æ— æ•ˆçš„éš¾åº¦å‚æ•°');
                    }
                    
                    timerDisplay.textContent = timeLeft;
                    startGame();
                } catch (error) {
                    console.error('é€‰æ‹©éš¾åº¦æ—¶å‡ºé”™:', error);
                    messageDisplay.textContent = "éš¾åº¦é€‰æ‹©å‡ºé”™ï¼Œè¯·é‡è¯•ï¼";
                }
            }
        });
        
        // ä¸ºéš¾åº¦æŒ‰é’®æ·»åŠ é”®ç›˜æ”¯æŒï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰
        document.querySelector('.difficulty-buttons').addEventListener('keydown', (e) => {
            if (e.target.classList.contains('difficulty-btn') && (e.key === 'Enter' || e.key === ' ')) {
                e.preventDefault();
                e.target.click();
            }
        });

        // äº‹ä»¶ç›‘å¬
        startButton.addEventListener('click', () => {
            try {
                difficultyOverlay.classList.add('active');
            } catch (error) {
                console.error('æ˜¾ç¤ºéš¾åº¦é€‰æ‹©æ—¶å‡ºé”™:', error);
            }
        });
        
        restartButton.addEventListener('click', () => {
            try {
                currentLevel = 1;
                difficultyOverlay.classList.add('active');
                messageDisplay.textContent = "";
            } catch (error) {
                console.error('é‡å¯æ¸¸æˆæ—¶å‡ºé”™:', error);
            }
        });
        
        target.addEventListener('click', hitTarget);
        
        // é”®ç›˜æ”¯æŒï¼šå…è®¸ä½¿ç”¨Enteræˆ–Spaceé”®ç‚¹å‡»ç›®æ ‡
        target.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                hitTarget();
            }
        });
        
        // æ¸¸æˆå®¹å™¨ç‚¹å‡»äº‹ä»¶ï¼ˆå¤„ç†æœªå‡»ä¸­æƒ…å†µï¼‰
        gameContainer.addEventListener('click', (e) => {
            if (gameActive && e.target === gameContainer) {
                missCount++;
            }
        });
        
        // å…¨å±€é”®ç›˜æ”¯æŒ
        document.addEventListener('keydown', (e) => {
            // ç©ºæ ¼é”®å¼€å§‹æ¸¸æˆï¼ˆå½“æ¸¸æˆæœªæ¿€æ´»æ—¶ï¼‰
            if (e.key === ' ' && !gameActive) {
                e.preventDefault();
                if (startButton.style.display !== 'none') {
                    difficultyOverlay.classList.add('active');
                }
            }
            
            // ESCé”®å…³é—­éš¾åº¦é€‰æ‹©
            if (e.key === 'Escape' && difficultyOverlay.classList.contains('active')) {
                difficultyOverlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>